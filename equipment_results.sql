SELECT 
    m.ID,
    m.RECORD_NAME,
    m.RAW_DATA,
    DBMS_LOB.SUBSTR(m.RAW_DATA_LONG_TEXT, 4000, 1) as RAW_DATA_PREVIEW,
    ms.SAMPLE_ID,
    m.MEASUREMENT_TYPE
FROM RES_MEASUREMENT m
JOIN RES_MEASUREMENTSAMPLE ms ON m.ID = ms.MEASUREMENT_ID
WHERE ms.SAMPLE_ID = 'S001'
AND ROWNUM <= 5;

--prior doesnt give the data, just meta data on it next query to look for the data

SELECT 
    ms.SAMPLE_ID,
    ms.ROW_INDEX,
    p.DISPLAY_LABEL,
    pv.VALUE_STRING,
    pv.VALUE_NUMERIC,
    pv.VALUE_TEXT
FROM RES_MEASUREMENTSAMPLE ms
JOIN COR_OBJECT_IDENTITY oi ON oi.OBJECT_ID = ms.ID
JOIN COR_CLASS_IDENTITY ci ON ci.ID = oi.CLASS_IDENTITY_ID
JOIN COR_PROPERTY_VALUE pv ON pv.OBJECT_IDENTITY_ID = oi.ID  
JOIN COR_PROPERTY p ON p.NAME = pv.PROPERTY_ID
WHERE ms.SAMPLE_ID = 'S001'
AND ci.TABLE_NAME = 'res_measurementsample';

--that gave nothing so lets try

SELECT 
    m.ID,
    m.MEASUREMENT_TYPE,
    m.INFO,
    m.CONTEXT,
    m.RAW_DATA,
    DBMS_LOB.SUBSTR(m.RAW_DATA_LONG_TEXT, 4000, 1) as RAW_DATA_PREVIEW
FROM RES_MEASUREMENT m
JOIN RES_MEASUREMENTSAMPLE ms ON m.ID = ms.MEASUREMENT_ID
WHERE ms.SAMPLE_ID = 'S001';

--that didn't help either, next

SELECT 
    p.DISPLAY_NAME,
    pv.VALUE_STRING,
    pv.VALUE_NUMERIC,
    pv.INTERPRETATION
FROM RES_MEASUREMENTSAMPLE ms
JOIN COR_PARAMETER_VALUE pv ON pv.PARENT_IDENTITY = ms.ID
JOIN COR_PARAMETER p ON p.ID = pv.PARAMETER_ID
WHERE ms.SAMPLE_ID = 'S001'
AND pv.VALUE_KEY = 'A';

--couple steps skipped, next big q

SELECT 
    pv.ID,
    pv.PARENT_IDENTITY,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING,
    pv.ITEM_INDEX,
    pv.VALUE_KEY,
    pv.INTERPRETATION
FROM COR_PARAMETER_VALUE pv
JOIN COR_PARAMETER p ON p.ID = pv.PARENT_IDENTITY
WHERE p.ID = '<paste that long ID string here>'
AND pv.VALUE_NUMERIC = 19.2
AND ROWNUM <= 5;

--try pex values? (process execution)

SELECT 
    ctx.CONTEXT as pex_urn,
    pex.ID,
    pex.STATE
FROM RES_RETRIEVAL_CONTEXT ctx
JOIN RES_MEASUREMENTSAMPLE ms ON ctx.ID = ms.CONTEXT_ID
JOIN PEX_PROC_ELEM_EXEC pex ON ctx.CONTEXT = 'urn:compose:pex_proc_elem_exec:' || RAWTOHEX(pex.ID)
WHERE ms.SAMPLE_ID = 'S001';

--and more

SELECT 
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING,
    peep.ID as ELEM_EXEC_PARAM_ID,
    pee.ID as PROC_ELEM_EXEC_ID,
    pe.ID as PROC_EXEC_ID,
    ctx.ID as CONTEXT_ID,
    ctx.CONTEXT,
    ms.SAMPLE_ID,
    ms.MEASUREMENT_ID
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 'urn:compose:pex_proc_elem_exec:' || RAWTOHEX(pee.ID)
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
WHERE pv.VALUE_NUMERIC = 19.2
AND ROWNUM = 1;

SELECT 
    'urn:pexelement:' || RAWTOHEX(pee.ID) as constructed_urn,
    ctx.CONTEXT as actual_urn,
    CASE WHEN 'urn:pexelement:' || RAWTOHEX(pee.ID) = ctx.CONTEXT THEN 'MATCH' ELSE 'NO MATCH' END as match_status
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
CROSS JOIN (
    SELECT ctx.* 
    FROM RES_RETRIEVAL_CONTEXT ctx
    JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
    WHERE ms.SAMPLE_ID = 'S001'
) ctx
WHERE pv.VALUE_NUMERIC = 19.2
AND ROWNUM = 1;

--handle pex properly
SELECT *
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
WHERE pv.VALUE_NUMERIC = 19.2
AND ROWNUM = 1;

--bring pv in

SELECT *
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
WHERE pv.VALUE_NUMERIC = 19.2;

SELECT *
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
WHERE pv.VALUE_NUMERIC = 19.2;

--can we get to runset?

SELECT 
    r.RUNSET_ID,
    t.TASK_ID,
    m.ID as MEASUREMENT_ID,
    ms.SAMPLE_ID,
    pv.VALUE_NUMERIC
FROM REQ_RUNSET r
JOIN REQ_TASK t ON t.RUNSET_ID = r.ID
JOIN RES_MEASUREMENT m ON m.EQUIPMENT_ID = t.EQUIPMENT_ID
JOIN RES_MEASUREMENTSAMPLE ms ON ms.MEASUREMENT_ID = m.ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.ID = ms.CONTEXT_ID
JOIN PEX_PROC_ELEM_EXEC pee ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.PARENT_ID = pee.ID
JOIN COR_PARAMETER_VALUE pv ON pv.PARENT_IDENTITY = peep.ID
WHERE r.RUNSET_ID = 'TP002'
AND ms.SAMPLE_ID = 'S001'
AND pv.VALUE_NUMERIC = 19.2;

--no dice, how about equipment to work

SELECT 
    m.ID,
    m.EQUIPMENT_ID,
    m.EQUIPMENT_WORK_ITEM_ID,
    m.MEASUREMENT_TYPE
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
WHERE pv.VALUE_NUMERIC = 19.2;

--ok calm 
SELECT 
    ms.SAMPLE_ID,
    ms.MAPPED_SAMPLE_ID,
    s.SAMPLE_ID as SAM_SAMPLE_ID
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
LEFT JOIN SAM_SAMPLE s ON s.ID = ms.MAPPED_SAMPLE_ID
WHERE pv.VALUE_NUMERIC = 19.2;

--result to req task?
SELECT *
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN SAM_SAMPLE s ON s.ID = ms.MAPPED_SAMPLE_ID
JOIN REQ_TASK t ON INSTR(',' || t.SAMPLE_LIST || ',', ',' || s.SAMPLE_ID || ',') > 0
WHERE pv.VALUE_NUMERIC = 19.2;

--now can we map to TP?
SELECT *
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN SAM_SAMPLE s ON s.ID = ms.MAPPED_SAMPLE_ID
JOIN REQ_TASK t ON INSTR(',' || t.SAMPLE_LIST || ',', ',' || s.SAMPLE_ID || ',') > 0
JOIN REQ_RUNSET r ON r.ID = t.RUNSET_ID
WHERE pv.VALUE_NUMERIC = 19.2;

--bring in parameter name

SELECT 
    r.RUNSET_ID,
    s.SAMPLE_ID,
    param.DISPLAY_NAME as CHARACTERISTIC_NAME,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN SAM_SAMPLE s ON s.ID = ms.MAPPED_SAMPLE_ID
JOIN REQ_TASK t ON INSTR(',' || t.SAMPLE_LIST || ',', ',' || s.SAMPLE_ID || ',') > 0
JOIN REQ_RUNSET r ON r.ID = t.RUNSET_ID
JOIN COR_PARAMETER param ON param.ID = peep.PARENT_ID
WHERE r.RUNSET_ID = 'TP002'
AND s.SAMPLE_ID = 'S001';

-- and again

SELECT 
    r.RUNSET_ID,
    s.SAMPLE_ID,
    param.DISPLAY_NAME as CHARACTERISTIC_NAME,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING,
    peep.SOURCE_POSITION,
    pep.PARAMETER_ID
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN PEX_PROC_EXEC_PARAM pep ON pep.PARENT_ID = pe.ID AND pep.PARAMETER_ID IS NOT NULL
JOIN COR_PARAMETER param ON param.ID = pep.PARAMETER_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN SAM_SAMPLE s ON s.ID = ms.MAPPED_SAMPLE_ID
JOIN REQ_TASK t ON INSTR(',' || t.SAMPLE_LIST || ',', ',' || s.SAMPLE_ID || ',') > 0
JOIN REQ_RUNSET r ON r.ID = t.RUNSET_ID
WHERE pv.VALUE_NUMERIC = 19.2;

--how to connect - prior gave a lot of bs

SELECT 
    pv.ID,
    pv.PARENT_IDENTITY,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING,
    pv.VALUE_URN,
    pv.VALUE_TYPE,
    pv.ITEM_INDEX,
    pv.GROUP_INDEX,
    pv.VALUE_KEY,
    pv.CONTEXT_ATTRIBUTE
FROM COR_PARAMETER_VALUE pv
WHERE pv.VALUE_NUMERIC = 19.2
AND ROWNUM = 1;

SELECT 
    peep.SOURCE_POSITION,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING,
    pv.CONTEXT_ATTRIBUTE
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
WHERE ms.SAMPLE_ID = 'S001'
ORDER BY peep.SOURCE_POSITION;

--p_id to stuff?

SELECT 
    pep.PARAMETER_ID,
    param.DISPLAY_NAME,
    ROW_NUMBER() OVER (PARTITION BY pep.PARENT_ID ORDER BY pep.ID) - 1 as CALCULATED_POSITION
FROM PEX_PROC_EXEC pe
JOIN PEX_PROC_EXEC_PARAM pep ON pep.PARENT_ID = pe.ID
JOIN COR_PARAMETER param ON param.ID = pep.PARAMETER_ID
JOIN PEX_PROC_ELEM_EXEC pee ON pee.PARENT_ID = pe.ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
WHERE ms.SAMPLE_ID = 'S001'
ORDER BY CALCULATED_POSITION;

--need to get right result here please
SELECT 
    r.RUNSET_ID,
    s.SAMPLE_ID,
    param.DISPLAY_NAME as CHARACTERISTIC_NAME,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING,
    peep.SOURCE_POSITION,
    pt.SEQUENCE_POSITION
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN PEX_PROC_EXEC_PARAM pep ON pep.PARENT_ID = pe.ID
JOIN COR_PARAMETER_TEMPLATE pt ON pt.PARAMETER_ID = pep.PARAMETER_ID
    AND pt.SEQUENCE_POSITION = peep.SOURCE_POSITION
JOIN COR_PARAMETER param ON param.ID = pep.PARAMETER_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN SAM_SAMPLE s ON s.ID = ms.MAPPED_SAMPLE_ID
JOIN REQ_TASK t ON INSTR(',' || t.SAMPLE_LIST || ',', ',' || s.SAMPLE_ID || ',') > 0
JOIN REQ_RUNSET r ON r.ID = t.RUNSET_ID
WHERE pv.VALUE_NUMERIC = 19.2;

--no dice, next attempt
SELECT 
    param.DISPLAY_NAME,
    pt.SEQUENCE_POSITION,
    pep.PARAMETER_ID
FROM PEX_PROC_EXEC pe
JOIN PEX_PROC_EXEC_PARAM pep ON pep.PARENT_ID = pe.ID
JOIN COR_PARAMETER param ON param.ID = pep.PARAMETER_ID
JOIN PEX_PROC_ELEM_EXEC pee ON pee.PARENT_ID = pe.ID
LEFT JOIN COR_PARAMETER_TEMPLATE pt ON pt.PARAMETER_ID = pep.PARAMETER_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
WHERE ms.SAMPLE_ID = 'S001'
ORDER BY param.DISPLAY_NAME;

--aargh, I think
SELECT 
    r.RUNSET_ID,
    s.SAMPLE_ID,
    param_exec.DISPLAY_NAME as CHARACTERISTIC_NAME,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING,
    peep.SOURCE_POSITION
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN PEX_PROC_EXEC_PARAM pep ON pep.PARENT_ID = pe.ID
JOIN COR_PARAMETER param_exec ON param_exec.ID = pep.PARAMETER_ID
JOIN COR_PARAMETER param_template ON (
    param_template.ROOT_ID = param_exec.ROOT_ID 
    OR param_template.ID = param_exec.ROOT_ID
    OR param_template.ID = param_exec.CLONED_FROM
)
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN SAM_SAMPLE s ON s.ID = ms.MAPPED_SAMPLE_ID
JOIN REQ_TASK t ON INSTR(',' || t.SAMPLE_LIST || ',', ',' || s.SAMPLE_ID || ',') > 0
JOIN REQ_RUNSET r ON r.ID = t.RUNSET_ID
WHERE param_template.DISPLAY_NAME = 'OV Meter Reading [%]'
AND pv.VALUE_NUMERIC = 19.2;

--where is my proper display name thoi?

SELECT 
    pv.ID,
    pv.PARENT_IDENTITY,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING,
    pv.VALUE_TEXT,
    pv.VALUE_URN,
    pv.VALUE_TYPE,
    pv.CONTEXT_ATTRIBUTE,
    pv.INTERPRETATION,
    pv.ITEM_INDEX,
    pv.GROUP_INDEX
FROM COR_PARAMETER_VALUE pv
WHERE pv.VALUE_NUMERIC = 19.2
AND ROWNUM = 1;

--for the love of jesus please
SELECT 
    df.NAME as FIELD_NAME,
    df.DISPLAY_ORDER,
    peep.SOURCE_POSITION,
    pv.VALUE_NUMERIC
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN RES_EQUIPMENT eq ON eq.ID = m.EQUIPMENT_ID
JOIN RES_EQUIPMENT_TYPE et ON et.ID = eq.EQUIPMENT_TYPE_ID
JOIN RES_DATA_PACKET dp ON dp.ID = et.DATA_PACKET_ID
JOIN RES_DATA_FIELD df ON df.DATA_PACKET_ID = dp.ID
WHERE pv.VALUE_NUMERIC = 19.2;

--next?

SELECT 
    df.NAME as FIELD_NAME,
    ve.NAME as VOCAB_NAME,
    ve.DESCRIPTION as VOCAB_DESCRIPTION,
    df.DISPLAY_ORDER,
    peep.SOURCE_POSITION,
    pv.VALUE_NUMERIC
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN RES_EQUIPMENT eq ON eq.ID = m.EQUIPMENT_ID
JOIN RES_EQUIPMENT_TYPE et ON et.ID = eq.EQUIPMENT_TYPE_ID
JOIN RES_DATA_PACKET dp ON dp.ID = et.DATA_PACKET_ID
JOIN RES_DATA_FIELD df ON df.DATA_PACKET_ID = dp.ID
    AND df.DISPLAY_ORDER = peep.SOURCE_POSITION
LEFT JOIN COR_VOCAB_ENTRY ve ON ve.ID = d

--aaargh

SELECT 
    df.NAME as FIELD_NAME,
    u.NAME as UNIT_NAME,
    ve.NAME as VOCAB_NAME,
    df.NAME || ' [' || u.NAME || ']' as FULL_NAME,
    pv.VALUE_NUMERIC
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN RES_EQUIPMENT eq ON eq.ID = m.EQUIPMENT_ID
JOIN RES_EQUIPMENT_TYPE et ON et.ID = eq.EQUIPMENT_TYPE_ID
JOIN RES_DATA_PACKET dp ON dp.ID = et.DATA_PACKET_ID
JOIN RES_DATA_FIELD df ON df.DATA_PACKET_ID = dp.ID
    AND df.DISPLAY_ORDER = peep.SOURCE_POSITION
LEFT JOIN COR_UNIT u ON u.ID = df.UNIT_ID
LEFT JOIN COR_VOCAB_ENTRY ve ON ve.ID = df.REFERENCE_ONTOLOGY_ID
WHERE pv.VALUE_NUMERIC = 19.2;

--testing
SELECT 
    df.NAME as FIELD_NAME,
    u.NAME as UNIT_NAME,
    ve.NAME as VOCAB_NAME
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN RES_EQUIPMENT eq ON eq.ID = m.EQUIPMENT_ID
JOIN RES_EQUIPMENT_TYPE et ON et.ID = eq.EQUIPMENT_TYPE_ID
JOIN RES_DATA_PACKET dp ON dp.ID = et.DATA_PACKET_ID
JOIN RES_DATA_FIELD df ON df.DATA_PACKET_ID = dp.ID
    AND df.DISPLAY_ORDER = peep.SOURCE_POSITION
LEFT JOIN COR_UNIT u ON u.ID = df.UNIT_ID
LEFT JOIN COR_VOCAB_ENTRY ve ON ve.ID = df.REFERENCE_ONTOLOGY_ID
WHERE pv.VALUE_NUMERIC = 19.2;

SELECT 
    df.NAME as FIELD_NAME,
    df.DISPLAY_ORDER,
    u.NAME as UNIT_NAME,
    ve.NAME as VOCAB_NAME,
    peep.SOURCE_POSITION,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN RES_EQUIPMENT eq ON eq.ID = m.EQUIPMENT_ID
JOIN RES_EQUIPMENT_TYPE et ON et.ID = eq.EQUIPMENT_TYPE_ID
JOIN RES_DATA_PACKET dp ON dp.ID = et.DATA_PACKET_ID
JOIN RES_DATA_FIELD df ON df.DATA_PACKET_ID = dp.ID
LEFT JOIN COR_UNIT u ON u.ID = df.UNIT_ID
LEFT JOIN COR_VOCAB_ENTRY ve ON ve.ID = df.REFERENCE_ONTOLOGY_ID
WHERE ms.SAMPLE_ID = 'S001'
AND peep.SOURCE_POSITION = 4;

--single row??!

SELECT 
    r.RUNSET_ID,
    s.SAMPLE_ID,
    ve.NAME as CHARACTERISTIC_NAME,
    u.NAME as UNIT,
    pv.VALUE_NUMERIC,
    pv.VALUE_STRING
FROM COR_PARAMETER_VALUE pv
JOIN PEX_PROC_ELEM_EXEC_PARAM peep ON peep.ID = pv.PARENT_IDENTITY
JOIN PEX_PROC_ELEM_EXEC pee ON pee.ID = peep.PARENT_ID
JOIN PEX_PROC_EXEC pe ON pe.ID = pee.PARENT_ID
JOIN RES_RETRIEVAL_CONTEXT ctx ON ctx.CONTEXT = 
    'urn:pexelement:' || 
    LOWER(
        SUBSTR(RAWTOHEX(pee.ID), 1, 8) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 9, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 13, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 17, 4) || '-' ||
        SUBSTR(RAWTOHEX(pee.ID), 21, 12)
    )
JOIN RES_MEASUREMENTSAMPLE ms ON ms.CONTEXT_ID = ctx.ID
JOIN RES_MEASUREMENT m ON m.ID = ms.MEASUREMENT_ID
JOIN SAM_SAMPLE s ON s.ID = ms.MAPPED_SAMPLE_ID
JOIN REQ_TASK t ON INSTR(',' || t.SAMPLE_LIST || ',', ',' || s.SAMPLE_ID || ',') > 0
JOIN REQ_RUNSET r ON r.ID = t.RUNSET_ID
JOIN RES_EQUIPMENT eq ON eq.ID = m.EQUIPMENT_ID
JOIN RES_EQUIPMENT_TYPE et ON et.ID = eq.EQUIPMENT_TYPE_ID
JOIN RES_DATA_PACKET dp ON dp.ID = et.DATA_PACKET_ID
JOIN RES_DATA_FIELD df ON df.DATA_PACKET_ID = dp.ID
    AND df.DISPLAY_ORDER = peep.SOURCE_POSITION
LEFT JOIN COR_UNIT u ON u.ID = df.UNIT_ID
LEFT JOIN COR_VOCAB_ENTRY ve ON ve.ID = df.REFERENCE_ONTOLOGY_ID
WHERE r.RUNSET_ID = 'TP002'
AND s.SAMPLE_ID = 'S001'
AND ve.NAME = 'OV_Meter_Reading'
AND pv.VALUE_NUMERIC IS NOT NULL;
